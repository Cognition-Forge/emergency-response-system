# How Final Scores Are Calculated

Based on my analysis of the codebase and the output logs, I can explain how the **final scores** are calculated and why they vary so dramatically across the three scenarios:

## How Final Scores Are Calculated

The `score` field in the `OptionAssessment` model (line 189 in models.py) is generated by the **OpenAI AI agent**, not through a deterministic formula in the code. The AI agent receives:

1. **Scenario-specific prompts** that define different risk postures
2. **Configuration parameters** (risk tolerance, approval preference, etc.)
3. **Inventory options** with their constraints and requirements
4. **Failed item context** (what needs to be accommodated)

The AI then assigns scores based on how well each option aligns with the scenario's strategic posture.

## Why Scores Differ So Dramatically

### **Scenario 1: Score 95.0**
- **Posture**: Conservative ("minimize approval overhead, protect schedule commitments")
- **Situation**: Perfect match - 20 Emergency Shelter Kits available, **no approvals required**
- **AI Logic**: High score because it meets the conservative criteria perfectly - no risk, no delays, full coverage
- **Score reflects**: Near-perfect alignment with conservative risk tolerance

### **Scenario 2: Score 0.8**
- **Posture**: Balanced ("weigh schedule recovery and approval complexity evenly")
- **Situation**: **Partial shortage** - need 60 kits, only 18 available without approval
- **AI Logic**: Low score because it only provides 18/60 units (30% coverage) - significant shortfall
- **Score reflects**: Poor coverage despite no approval requirements

### **Scenario 3: Score 8.0**
- **Posture**: Aggressive ("favor rapid recovery, accept complex approvals")
- **Situation**: **Critical shortage** - need 24 power packs, only 8 available with manager approval
- **AI Logic**: Higher score than scenario 2 despite partial coverage because:
  - Aggressive posture accepts approval complexity
  - "Critical Decision" impact level aligns with aggressive risk acceptance
  - Partial recovery (8/24 = 33%) is valued higher in aggressive context

## Key Insight

The scoring system is **contextual and scenario-driven**, not a simple mathematical formula. The AI weighs:
- **Coverage percentage** (how much of the need is met)
- **Approval requirements** (weighted by scenario risk tolerance)
- **Impact levels** (how disruptive the solution is)
- **Scenario posture** (conservative vs. aggressive strategic approach)

This explains why a partial solution scores higher in an aggressive scenario (8.0) than a partial solution in a balanced scenario (0.8) - the aggressive posture values decisive action over perfect coverage.